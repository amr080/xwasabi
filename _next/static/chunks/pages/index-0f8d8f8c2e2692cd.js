(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5405],{48312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(4999)}])},1966:function(e,t,n){"use strict";n.d(t,{r:function(){return o}});var a=n(85893),s=n(60263),i=n(22852),r=n(61856);n(67294);let o=e=>{let{value:t,onChange:n,symbol:o,tokenDecimals:l,placeholder:d="Amount",imageUrl:c,displayTokenSelect:p}=e;return(0,a.jsxs)("div",{className:"standard-frame flex flex-row gap-2 justify-between p-2 text-xl",children:[(0,a.jsx)("input",{type:"number",className:"unstyled-input flex-grow",placeholder:d,maxLength:7,min:0,value:t?(0,s.b)(t,l):void 0,onChange:e=>{let t=e.target.value;t?n((0,i.v)(t,l)):n(void 0)}}),(0,a.jsx)(r.W,{symbol:o,imageUrl:c,displayTokenSelect:p||!1})]})}},49277:function(e,t,n){"use strict";n.d(t,{U:function(){return l}});var a=n(85893),s=n(60263),i=n(94184),r=n.n(i);n(67294);var o=n(61856);let l=e=>{let{value:t,symbol:n,tokenDecimals:i,placeholder:l,isLoading:d,imageUrl:c,displayTokenSelect:p}=e,u=t?(0,s.b)(t,i):l;return t&&(u=parseFloat(Number(u).toFixed(4)).toLocaleString()),(0,a.jsxs)("div",{className:"standard-frame flex flex-row gap-2 justify-between items-center p-2 text-xl",children:[d?(0,a.jsx)("div",{className:"flex-grow rounded-md bg-slate-600 animate-pulse h-[32px]"}):(0,a.jsx)("span",{className:r()({"text-neutral-content":!t}),children:u}),(0,a.jsx)(o.W,{symbol:n,imageUrl:c,displayTokenSelect:p||!1})]})}},61856:function(e,t,n){"use strict";n.d(t,{W:function(){return d}});var a=n(85893);n(67294);var s=n(4567),i=n(88707),r=n(94184),o=n.n(r),l=n(60155);let d=e=>{let{imageUrl:t,symbol:n,displayTokenSelect:r=!1,onClick:d}=e,c=(0,s.d)();return(0,a.jsxs)("div",{className:o()("w-max flex flex-row items-center justify-between gap-1 glassborder rounded-full px-2 py-1",{"cursor-pointer hover:bg-glass-focus":r||d}),onClick:()=>(d&&d(),r&&c.show()),children:[t||"ETH"===n||"WETH"===n?(0,a.jsx)("img",{src:"USDB"===n?"https://wasabi-public.s3.amazonaws.com/tokens/usdb.png":t||"https://wasabi-public.s3.amazonaws.com/tokens/weth.png",className:"w-7 h-7 rounded-full",alt:n}):(0,a.jsx)("div",{className:"w-7 h-7 rounded-full text-[8px] glassborder flex items-center justify-center",children:n.substring(0,3)}),(0,a.jsx)("span",{className:"text-neutral-content select-none text-base",children:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return e.length>t?(0,a.jsxs)(a.Fragment,{children:[e.slice(0,t-1),"â€¦"]}):(0,a.jsx)(a.Fragment,{children:e})}(n)}),(r||d)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"flex items-center",children:(0,a.jsx)(l.CgR,{size:16,className:"text-neutral-content"})}),(0,a.jsx)(s.u,{...c,children:(0,a.jsx)(i.j,{onSelected:c.hide})})]})]})}},88707:function(e,t,n){"use strict";n.d(t,{j:function(){return v}});var a=n(85893),s=n(53990),i=n(76790),r=n(67294),o=n(88767),l=n(85821),d=n(40364),c=n(94184),p=n.n(c),u=n(66653),m=n(24068),x=n(13331),h=n(11163),y=n(98716),g=n(85863),f=n(69077),b=n(75840),w=n(79217);let v=e=>{var t,n;let{onSelected:c}=e,{address:v}=(0,f.mA)(),j=(0,x.f)(),N=(0,h.useRouter)(),{userSelections:T,handleSelection:k}=(0,m.E)(),[C,S]=(0,r.useState)(""),[E,P]=(0,w.y)("token",T.token||y.pe),L=(0,o.useQuery)("perp_configs",async()=>await (0,l.c4)(),{enabled:!0}),_=(null===(t=L.data)||void 0===t?void 0:t.items.filter(e=>y.PD.indexOf(v||"")>=0||e.token.address.toLowerCase()!==g.y_.toLowerCase()).filter(e=>e.token.symbol.toLowerCase().includes(C.toLowerCase())||e.token.name.toLowerCase().includes(C.toLowerCase())))||[],I=e=>{if(j&&N.isReady&&"Enter"===e.key&&_.length>0){let e=_[0],t="/?t=active&side=long&token=".concat(e.token.symbol);N.push(t)}},A=[{id:"token",label:"Token",valueRenderer:e=>(0,a.jsxs)("div",{className:"flex flex-row items-center gap-1 md:gap-2",children:[(0,a.jsx)("img",{src:e.token.imageUrl,alt:e.token.symbol,className:"w-6 h-6 rounded-full border border-glass-focus"}),(0,a.jsx)("span",{className:"text-xs lg:text-base ",children:"USDB"===e.token.symbol?"ETH/USDB":e.token.symbol+"/ETH"})]}),span:2,align:"left",sort:(0,i.V2)(e=>e.token.symbol),columnOnClick:e=>k("tokenSearchSort",e)},{id:"price",label:"Price",valueRenderer:e=>(0,a.jsx)(d.i,{exponentClassName:"text-xs text-neutral-content",className:"text-sm md:text-base ",iconSize:12,price:Number(e.tokenStats.price),showAsFullNFT:!1,tokenAddress:e.token.address,tokenType:e.token.tokenType}),align:"right",sort:(0,i.dY)(e=>Number(e.tokenStats.price)),columnOnClick:e=>k("tokenSearchSort",e)},{id:"24hChange",label:"24h Change",valueRenderer:e=>(0,a.jsxs)("div",{className:p()("text-sm flex items-center",{"text-put":e.tokenStats.oneDayChange<0,"text-call":e.tokenStats.oneDayChange>0,"text-neutral-content":0===e.tokenStats.oneDayChange}),children:[e.tokenStats.oneDayChange>0?(0,a.jsx)(u.rBm,{size:16}):(0,a.jsx)(u.WMq,{size:16}),Math.abs(e.tokenStats.oneDayChange).toFixed(2),"%"]}),align:"right",sort:(0,i.dY)(e=>e.tokenStats.oneDayChange),columnOnClick:e=>k("tokenSearchSort",e)},{id:"24hVolume",label:"24h Volume",valueRenderer:e=>(0,a.jsxs)("span",{className:"flex flex-row items-center !text-lg",children:[(0,a.jsx)("span",{className:"",children:"$"}),(0,b.ER)(e.tokenStats.oneDayVolumeUsd)]}),align:"right",sort:(0,i.dY)(e=>e.tokenStats.oneDayVolumeUsd),columnOnClick:e=>k("tokenSearchSort",e)}];return(0,a.jsxs)("div",{className:"w-full standard-stack",children:[(0,a.jsxs)("div",{className:"w-full flex flex-row items-center glassborder rounded-md",children:[(0,a.jsx)(s.Yfv,{className:"searchbar-icon ml-4 mr-4 cursor-pointer",size:18}),(0,a.jsx)("input",{className:"h-10 inline-block cursor-pointer border-none outline-none bg-transparent w-full hover:cursor-text",type:"text",placeholder:"Search markets",value:C,onChange:e=>{let t=e.target.value;S(t)},onPaste:e=>{let t=e.clipboardData.getData("text");e.preventDefault(),S(t)},onKeyUp:e=>{"Enter"===e.key&&I(e)},autoComplete:"off",autoFocus:!0})]}),(0,a.jsx)("hr",{className:"border-neutral-content/30"}),(0,a.jsx)(i.iA,{id:"perp_positions",className:"max-h-[500px] md:min-w-[700px]",columns:A,data:null===(n=L.data)||void 0===n?void 0:n.items.filter(e=>e.token.symbol.toLowerCase().includes(C.toLowerCase())||e.token.name.toLowerCase().includes(C.toLowerCase())),initialSort:T.tokenSearchSort||"24hVolume",initialSortDirection:"desc",isLoading:L.isLoading,rowOnClick:e=>{c&&c(e.token),P(e.token.symbol)}})]})}},31277:function(e,t,n){"use strict";n.d(t,{h:function(){return x}});var a=n(85893),s=n(18726),i=n(70231),r=n(67294),o=n(4567),l=n(42038),d=n(99077),c=n(98716);let p=[1,5,10,50,100],u=e=>{let{initialSlippage:t,onSlippageChanged:n}=e,[i,o]=r.useState(t);return(0,a.jsxs)("div",{className:"standard-stack gap-2",children:[(0,a.jsx)(l.H,{label:"Max. Slippage",tooltip:"Your transaction will revert if the price changes unfavorably by more than this percentage.",children:(0,a.jsxs)("div",{className:"standard-frame flex flex-row items-end gap-2 p-2",children:[(0,a.jsx)("input",{className:"unstyled-input flex-grow text-right min-w-[100px] text-white",type:"number",min:0,max:c.j2,step:.01,value:i?i/100:void 0,placeholder:"0.5",onChange:e=>{let t=e.target.value;""===t?o(void 0):o(100*parseFloat(t))}}),(0,a.jsx)("span",{children:"%"})]})}),(0,a.jsx)("hr",{className:"border-neutral-content/50"}),(0,a.jsx)("div",{className:"flex flex-row justify-between gap-2",children:p.map(e=>(0,a.jsxs)("div",{className:"text-neutral-content hover:text-white hover:cursor-pointer",onClick:()=>o(e),children:[e/100,"%"]},"slippage_option".concat(e)))}),(0,a.jsx)("hr",{className:"border-neutral-content/50"}),(0,a.jsx)(s.z,{buttonType:s.L.SECONDARY,disabled:void 0===i||i>c.j2,onClick:()=>void 0!==i&&n(i),children:"Confirm"}),(0,a.jsxs)("div",{className:"max-w-[350px]",children:[void 0!==i&&i>c.j2&&(0,a.jsx)(d.G,{message:"Maximum allowed slippage is ".concat(c.j2/100,"%")}),void 0!==i&&i>c.NX&&(0,a.jsx)(d.G,{message:"Warning: A higher slippage could result in an undesirable entry price."})]})]})};var m=n(24068);let x=()=>{let e=(0,o.d)(),{userSelections:t,handleSelection:n}=(0,m.E)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.z,{buttonType:s.L.NEUTRAL,onClick:e.show,className:"!border-none !px-2 !py-2 !text-sm!font-light flex items-center",children:[t.slippage/100,"% slippage ",(0,a.jsx)(i.mdD,{})]}),(0,a.jsx)(o.u,{...e,title:"Set Slippage",children:(0,a.jsx)(u,{initialSlippage:t.slippage,onSlippageChanged:t=>{n("slippage",t),e.hide()}})})]})}},73999:function(e,t,n){"use strict";n.d(t,{$:function(){return m}});var a=n(85893),s=n(67294);n(1538);var i=n(47516),r=n(63750),o=n(85821),l=n(88767),d=n(23434),c=n(18726),p=n(51649),u=n(98716);let m=e=>{var t,n,m;let{perpTradeShare:x}=e,[h,y]=(0,s.useState)(),g=(0,l.useQuery)(["perp-trade-share",x.id],async()=>(0,o.K7)(x.id)),f=()=>{var e;if(null===(e=g.data)||void 0===e?void 0:e.data){let e=g.data.data,t=1===u.Kj?"perps":"blast",n=e.fileName.replace(".png","");return"https://".concat(t,".wasabi.xyz/perps/").concat(n,"?p=").concat(e.code,"&side=").concat(x.side,"&token=").concat(x.token.address)}return""};if(g.isLoading)return(0,a.jsxs)("div",{className:"p-2 standard-stack !gap-4 items-center max-w-[600px] relative",children:[(0,a.jsx)("span",{className:"w-full flex flex-row gap-2 items-center capitalize",children:(0,a.jsx)("div",{className:"rounded-md bg-slate-600 animate-pulse min-h-[280px] min-w-[580px] "})}),(0,a.jsx)("p",{className:"text-md",children:"Copy & Share"}),(0,a.jsx)("div",{className:"text-md flex items-center w-full",children:(0,a.jsx)("div",{className:" animate-pulse min-h-[55px]  w-full bg-slate-600 rounded-md p-4  "})})]});if(g.isError)return(0,a.jsx)("div",{className:"p-2 standard-stack !gap-4 items-center max-w-[900px] relative",children:(0,a.jsx)(d.y,{message:"Something went wrong. Please try again or contact us."})});let b=()=>{navigator.clipboard.writeText(f()).then(()=>{y("URL copied to clipboard"),setTimeout(()=>{y("")},2e3)})};return(0,a.jsxs)("div",{className:" p-2 standard-stack !gap-4 items-center max-w-[900px] relative",children:[(0,a.jsx)("span",{className:"w-full flex flex-row gap-2 items-center capitalize",children:g.data&&(0,a.jsx)("img",{alt:"trade_image",src:(null===(m=g.data)||void 0===m?void 0:m.data)?"https://wasabi-public.s3.amazonaws.com/trades/".concat(g.data.data.fileName):"",className:"standard-frame max-h-[310px] max-w-[600px] rounded-md"})}),(0,a.jsx)("p",{className:"text-lg text-white",children:"Share Position, Invite Friends and Earn Points"}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-center gap-2 w-full",children:[(0,a.jsxs)(c.z,{onClick:b,buttonType:c.L.SECONDARY,className:"min-w-[130px]",children:[(0,a.jsx)(i.fwS,{})," Copy"]}),(0,a.jsx)("a",{href:(0,o.YZ)((null===(t=g.data)||void 0===t?void 0:null===(n=t.data)||void 0===n?void 0:n.fileName)||""),target:"_blank",download:"wasabi_perps_trade_".concat(x.id),children:(0,a.jsxs)(c.z,{onClick:b,buttonType:c.L.SECONDARY,className:"min-w-[130px]",children:[(0,a.jsx)(p.Cb8,{})," Download"]})}),(0,a.jsx)("a",{href:"https://twitter.com/intent/tweet?text="+(()=>{let e=f();if(0===e.length)return"";let t=x.side,n=x.token.name;return"USDB"===x.token.symbol?(t="LONG"===t?"SHORT":"LONG",n="ETH"):x.token.twitterHandle&&(n=x.token.twitterHandle),encodeURIComponent("".concat("LONG"===t?"Longed":"Shorted"," ").concat(n," on @wasabi_protocol\n\n").concat(f()))})()+"&related=wasabi_protocol",target:"_blank",children:(0,a.jsxs)(c.z,{onClick:b,buttonType:c.L.PRIMARY,className:"min-w-[130px]",children:[(0,a.jsx)(r.meP,{})," Share"]})})]}),h&&(0,a.jsx)("span",{className:"text-sm text-green-500",children:h})]})}},84932:function(e,t,n){"use strict";n.d(t,{m:function(){return r}});var a=n(85893),s=n(94184),i=n.n(s);function r(e){let{label:t="",options:n,value:s,onChange:r,className:o=""}=e;return(0,a.jsxs)("div",{className:"flex p-1 border-[1px] border-neutral text-sm rounded-md items-center gap-2 ".concat(o||""),children:[t&&(0,a.jsxs)("span",{className:"text-neutral-content text-sm font-light",children:[t,": "]}),(0,a.jsx)("div",{className:"responsive-flex w-full",children:n.map((e,t)=>(0,a.jsxs)("button",{onClick:()=>r(e.value),className:i()("flex flex-row items-center justify-center gap-2 uppercase tracking-widest grow basis-0 text-[13px] p-1",{"bg-glass-focus text-primary-content":s===e.value,"text-neutral-content hover:bg-glass":s!==e.value}),children:[e.icon,e.label]},"tab_".concat(e.value)))})]})}},99077:function(e,t,n){"use strict";n.d(t,{G:function(){return i}});var a=n(85893);n(67294);var s=n(53990);let i=e=>{let{message:t}=e;return(0,a.jsxs)("div",{className:"flex flex-row items-center justify-center gap-2 text-warning rounded-md p-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(s.lsX,{size:12})}),(0,a.jsx)("div",{children:t})]})}},79217:function(e,t,n){"use strict";n.d(t,{W:function(){return r},y:function(){return i}});var a=n(11163),s=n(67294);function i(e,t){return r(e,t,e=>e)}function r(e,t,n){let i=(0,a.useRouter)(),r=i.query[e],o=t=>{i.replace({pathname:i.pathname,query:{...i.query,[e]:t}})};return(0,s.useEffect)(()=>{!r&&i.isReady&&o(t)},[i.isReady]),[r?n(Array.isArray(r)?r[0]:r):t,o]}},71873:function(e,t,n){"use strict";n.d(t,{D:function(){return m}});var a=n(85893),s=n(69077),i=n(88767),r=n(21419),o=n(98716);let l=()=>{var e;let{address:t}=(0,s.mA)(),n=void 0!==t&&o.PD.indexOf(t)>=0,a=(0,i.useQuery)(["geofence"],async()=>await (0,r.bh)(),{cacheTime:6e5,enabled:o.mC&&!n});return{isLoading:!n&&a.isLoading,isError:!n&&a.isError,isSuccess:n||!o.mC||a.isSuccess,isAllowed:n||!o.mC||(null===(e=a.data)||void 0===e?void 0:e.allowed)}};var d=n(50737),c=n(23434);n(67294);var p=n(57851);let u=(e,t)=>(0,a.jsx)("a",{href:t,target:"_blank",className:"text-blue-500",children:e}),m=e=>{let{children:t,className:n}=e,s=l();return(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[s.isLoading&&(0,a.jsx)(d.T,{}),s.isError&&(0,a.jsx)(c.y,{message:"Something went wrong. Please refresh the page."}),s.isSuccess&&(0,a.jsx)(a.Fragment,{children:s.isAllowed?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsxs)("div",{className:(0,p.m)("standard-frame p-8 text-xl mx-auto",n||""),children:["Wasabi is unavailable to people or companies who are residents of, or are located, incorporated or have a registered agent in United States of America, United Kingdom and other blocked countries or restricted territories.",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"Complete details can be found in our ",u("Terms of Use",o.Zd),"."]})})]})}},4999:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eQ}});var a=n(85893),s=n(2962),i=n(67294),r=n(13331),o=n(36253),l=n(4567),d=n(88707),c=n(82050),p=n(60155);let u=e=>{let{perpConfig:t,onChange:n}=e,s=(0,r.f)(),i=(0,o.E)("sm"),u=(0,l.d)();return s?(0,a.jsxs)("div",{className:"min-w-[340px]",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center justify-between divide-neutral-content/30 hover:bg-gray-700 cursor-pointer rounded-md relative p-2",onClick:u.show,children:[(0,a.jsxs)("div",{className:"flex flex-row gap-4 items-center",children:[(0,a.jsx)("img",{src:t.token.imageUrl,alt:t.token.symbol,className:"w-10 h-10 rounded-full border border-glass-focus"}),i?(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg lg:text-xl",children:"USDB"===t.token.symbol?"ETH":t.token.name.replace("Î¼","")}),(0,a.jsx)("span",{className:"text-neutral-content font-light text-sm",children:"USDB"===t.token.symbol?" ETH / USDB":t.token.symbol+" / ETH"})]}):(0,a.jsx)("div",{className:"text-lg lg:text-xl",children:t.token.symbol})]}),(0,a.jsx)(p.CgR,{})]}),(0,a.jsx)(c.L,{displayIcon:!0,address:t.token.address,label:"Block Explorer",className:"text-neutral-content text-xs"})]}),(0,a.jsx)(l.u,{...u,children:(0,a.jsx)(d.j,{onSelected:u.hide})})]}):null};var m=n(94184),x=n.n(m),h=n(70231),y=n(17667),g=n(51649);let f=e=>{let{side:t,onChange:n}=e,s=e=>(0,a.jsxs)("button",{onClick:()=>e!==t&&n(e),className:x()("capitalize flex flex-row gap-2 items-center justify-center flex-grow py-2 rounded-md font-light text-base",{"hover:bg-call/50":"long"===e,"bg-call/50":e===t&&"long"===e,"hover:bg-put/50":"short"===e,"bg-put/50":e===t&&"short"===e,"hover:bg-glass-focus":"swap"===e,"bg-glass-focus":e===t&&"swap"===e}),children:["long"===e?(0,a.jsx)(h.V4j,{}):"short"===e?(0,a.jsx)(h.GGD,{}):(0,a.jsx)(g.F_J,{})," ",(0,y.f)(e)]});return(0,a.jsxs)("div",{id:"perp-section-side",className:"standard-stack",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center gap-1",children:[s("long"),s("short"),s("swap")]}),(0,a.jsx)("hr",{className:"border-neutral-content/30"})]})};var b=n(63649),w=n(1966),v=n(49277),j=n(40364),N=n(60263),T=n(6665),k=n(46603),C=n(88767),S=n(85821),E=n(45810),P=n(62987),L=n(79217),_=n(40491);let I=[{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"_target",type:"address"}],name:"EthTransferFailed",type:"error"},{inputs:[],name:"IncorrectSwapParameter",type:"error"},{inputs:[],name:"InsufficientAmountProvided",type:"error"},{inputs:[],name:"InsufficientAvailablePrincipal",type:"error"},{inputs:[],name:"InsufficientCollateralReceived",type:"error"},{inputs:[],name:"InvalidCurrency",type:"error"},{inputs:[],name:"InvalidPosition",type:"error"},{inputs:[],name:"InvalidSignature",type:"error"},{inputs:[],name:"InvalidTargetCurrency",type:"error"},{inputs:[],name:"InvalidVault",type:"error"},{inputs:[],name:"LiquidationThresholdNotReached",type:"error"},{inputs:[],name:"OrderExpired",type:"error"},{inputs:[],name:"PositionAlreadyTaken",type:"error"},{inputs:[],name:"PrincipalTooHigh",type:"error"},{inputs:[],name:"SenderNotTrader",type:"error"},{inputs:[],name:"SwapFunctionNeeded",type:"error"},{inputs:[],name:"VaultAlreadyExists",type:"error"},{inputs:[],name:"WithdrawalNotAllowed",type:"error"},{inputs:[],name:"WithdrawerNotVault",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"pool",type:"address"},{indexed:!0,internalType:"address",name:"asset",type:"address"},{indexed:!1,internalType:"address",name:"vault",type:"address"}],name:"NewVault",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"id",type:"uint256"},{indexed:!1,internalType:"address",name:"trader",type:"address"},{indexed:!1,internalType:"uint256",name:"payout",type:"uint256"},{indexed:!1,internalType:"uint256",name:"principalRepaid",type:"uint256"},{indexed:!1,internalType:"uint256",name:"interestPaid",type:"uint256"},{indexed:!1,internalType:"uint256",name:"feeAmount",type:"uint256"}],name:"PositionClosed",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"id",type:"uint256"},{indexed:!1,internalType:"address",name:"trader",type:"address"},{indexed:!1,internalType:"uint256",name:"payout",type:"uint256"},{indexed:!1,internalType:"uint256",name:"principalRepaid",type:"uint256"},{indexed:!1,internalType:"uint256",name:"interestPaid",type:"uint256"},{indexed:!1,internalType:"uint256",name:"feeAmount",type:"uint256"}],name:"PositionLiquidated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"positionId",type:"uint256"},{indexed:!1,internalType:"address",name:"trader",type:"address"},{indexed:!1,internalType:"address",name:"currency",type:"address"},{indexed:!1,internalType:"address",name:"collateralCurrency",type:"address"},{indexed:!1,internalType:"uint256",name:"downPayment",type:"uint256"},{indexed:!1,internalType:"uint256",name:"principal",type:"uint256"},{indexed:!1,internalType:"uint256",name:"collateralAmount",type:"uint256"},{indexed:!1,internalType:"uint256",name:"feesToBePaid",type:"uint256"}],name:"PositionOpened",type:"event"},{inputs:[{internalType:"contract IWasabiVault",name:"_vault",type:"address"}],name:"addVault",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_unwrapWETH",type:"bool"},{components:[{internalType:"uint256",name:"expiration",type:"uint256"},{internalType:"uint256",name:"interest",type:"uint256"},{components:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"address",name:"trader",type:"address"},{internalType:"address",name:"currency",type:"address"},{internalType:"address",name:"collateralCurrency",type:"address"},{internalType:"uint256",name:"lastFundingTimestamp",type:"uint256"},{internalType:"uint256",name:"downPayment",type:"uint256"},{internalType:"uint256",name:"principal",type:"uint256"},{internalType:"uint256",name:"collateralAmount",type:"uint256"},{internalType:"uint256",name:"feesToBePaid",type:"uint256"}],internalType:"struct IWasabiPerps.Position",name:"position",type:"tuple"},{components:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IWasabiPerps.FunctionCallData[]",name:"functionCallDataList",type:"tuple[]"}],internalType:"struct IWasabiPerps.ClosePositionRequest",name:"_request",type:"tuple"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct IWasabiPerps.Signature",name:"_signature",type:"tuple"}],name:"closePosition",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_asset",type:"address"}],name:"getVault",outputs:[{internalType:"contract IWasabiVault",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bool",name:"_unwrapWETH",type:"bool"},{internalType:"uint256",name:"_interest",type:"uint256"},{components:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"address",name:"trader",type:"address"},{internalType:"address",name:"currency",type:"address"},{internalType:"address",name:"collateralCurrency",type:"address"},{internalType:"uint256",name:"lastFundingTimestamp",type:"uint256"},{internalType:"uint256",name:"downPayment",type:"uint256"},{internalType:"uint256",name:"principal",type:"uint256"},{internalType:"uint256",name:"collateralAmount",type:"uint256"},{internalType:"uint256",name:"feesToBePaid",type:"uint256"}],internalType:"struct IWasabiPerps.Position",name:"_position",type:"tuple"},{components:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IWasabiPerps.FunctionCallData[]",name:"_swapFunctions",type:"tuple[]"}],name:"liquidatePosition",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"address",name:"currency",type:"address"},{internalType:"address",name:"targetCurrency",type:"address"},{internalType:"uint256",name:"downPayment",type:"uint256"},{internalType:"uint256",name:"principal",type:"uint256"},{internalType:"uint256",name:"minTargetAmount",type:"uint256"},{internalType:"uint256",name:"expiration",type:"uint256"},{internalType:"uint256",name:"fee",type:"uint256"},{components:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IWasabiPerps.FunctionCallData[]",name:"functionCallDataList",type:"tuple[]"}],internalType:"struct IWasabiPerps.OpenPositionRequest",name:"_request",type:"tuple"},{components:[{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct IWasabiPerps.Signature",name:"_signature",type:"tuple"}],name:"openPosition",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_token",type:"address"},{internalType:"uint256",name:"_amount",type:"uint256"},{internalType:"address",name:"_receiver",type:"address"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wrapWETH",outputs:[],stateMutability:"nonpayable",type:"function"}];var A=n(85863),R=n(29427),z=n(75840),D=n(98716),F=n(85255);let O=e=>{let t="long"===e.side?A.ht:A.xf,n=[];return D.mC||n.push({name:"Allow Token Transfers",description:"Allow the transfer of your token to the pool",stepRenderer:(n,s)=>(0,a.jsx)(R.rC,{autoStart:!0,spender:t,requestMaxValue:!0,amount:(0,z.Md)(e.downPayment),contractAddress:A.tG,approvalChanged:e=>{e&&n()},className:"capitalize text-xs w-full"})}),n.push({name:"Open Position",description:"Opening a position",buttonQuery:()=>(0,C.useQuery)(["open_position",e.side,e.leverage,e.downPayment,e.tokenAddress],async()=>{let n=await (0,S.G7)(e),a={id:"open_position",loadingText:"Opening position...",addressOrName:t,functionName:"openPosition",contractInterface:I,args:[n.request,n.signature],overrides:{value:D.mC?BigInt(n.request.downPayment)+BigInt(n.request.fee):void 0},enabled:e.enabled};return a},{cacheTime:0})}),(0,a.jsx)(_.h,{id:"open_position",title:"Open Position",onSuccess:t=>void 0!==t&&e.onTransactionSuccess(t),transactionChain:n,enabled:e.enabled,type:F.iU.TRADE})};function B(e,t){let[n,a]=(0,i.useState)(e);return(0,i.useEffect)(()=>{let n=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(n)}},[e,t]),n}var U=n(23434),q=n(99077),W=n(30863),M=n(69077),H=n(61092),Q=n(66125),V=n(35450),Z=n(56399);let X=e=>{let{swapQuote:t}=e;return(0,a.jsxs)("div",{className:"standard-stack p-2",children:[t.tradePaths.map((e,n)=>(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 text-white",children:[(0,a.jsx)("span",{children:"".concat(e.percent,"%")}),(0,a.jsxs)("div",{className:"relative flex-grow",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,a.jsx)(Z.Z,{src:t.swapConfig.in.imageUrl||"https://wasabi-public.s3.amazonaws.com/tokens/weth.png",fallbackImage:"https://wasabi-public.s3.amazonaws.com/tokens/weth.png",initialImage:"/static/dkoda_loading.svg",className:"w-6 h-6 rounded-full z-50"}),Array(e.path.length-1).fill(0).map((t,n)=>{let s=e.path[n];return(0,a.jsx)("div",{className:"text-center text-[10px] bg-base-100 p-1 z-50 border rounded-md",children:"".concat(s,"/").concat(e.path[n+1]," ")},"".concat(s,"-").concat(n))}),(0,a.jsx)(Z.Z,{src:t.swapConfig.out.imageUrl||"https://wasabi-public.s3.amazonaws.com/tokens/weth.png",fallbackImage:"https://wasabi-public.s3.amazonaws.com/tokens/weth.png",initialImage:"/static/dkoda_loading.svg",className:"w-6 h-6 rounded-full z-50"})]}),(0,a.jsx)("div",{className:"absolute flex items-center top-5 left-0 right-0 text-neutral-content/50 text-sm z-30 border-neutral-content border-b border-dotted"})]})]})),(0,a.jsx)("hr",{className:"border-neutral-content/30"}),(0,a.jsx)("span",{className:"text-xs text-white max-w-[350px]",children:"We compute the smartest trade route to maximize your position size and reduce unnecessary price impact"})]})};var G=n(42444),Y=n(71873),$=n(24068),K=n(31277),J=n(22852),ee=n(61856);let et=e=>{let{label:t,value:n,onChange:s,token:i,isLoading:r,onTokenSelect:o,balance:c}=e,p=(0,l.d)(),u=[A.U,A.Sy];return(0,a.jsxs)("div",{className:"standard-frame flex flex-row justify-between items-center py-5 px-2 text-xl w-full",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1 max-w-[200px]",children:[(0,a.jsx)("span",{className:"text-neutral-content text-xs",children:t}),r?(0,a.jsx)("div",{className:"rounded-md w-[180px] h-[32px] bg-slate-600 animate-pulse flex-grow"}):(0,a.jsx)("input",{type:"number",className:"unstyled-input text-2xl text-white truncate w-[180px]",placeholder:"0",value:n?(0,N.b)(n,i.decimals):void 0,onChange:e=>{let t=e.target.value;t?s((0,J.v)(t,i.decimals)):s(void 0)}}),(0,a.jsx)("div",{})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,a.jsx)("div",{}),(0,a.jsx)(ee.W,{symbol:i.symbol,imageUrl:"imageUrl"in i?i.imageUrl:void 0,displayTokenSelect:!1,onClick:p.show}),(0,a.jsxs)("span",{className:"text-xs font-light text-neutral-content cursor-pointer",children:["Balance: ",Number((0,N.b)(c,i.decimals)).toLocaleString([],{maximumFractionDigits:2})," ","You pay"===t&&(0,a.jsx)("span",{className:"text-blue-500 hover:text-blue-300 hover:underline",onClick:()=>s(c),children:"Max"})]})]}),(0,a.jsxs)(l.u,{...p,children:[(0,a.jsx)("div",{className:"flex flex-row items-center gap-2 py-2",children:u.map(e=>(0,a.jsxs)("div",{className:"standard-frame !rounded-full flex flex-row gap-1 items-center px-3 py-1 hover:bg-glass-focus cursor-pointer",onClick:()=>{o(e),p.hide()},children:[(0,a.jsx)("img",{src:"https://wasabi-public.s3.amazonaws.com/tokens/weth.png",className:"w-6 h-6 rounded-full",alt:"base_token_".concat(e.symbol)}),(0,a.jsx)("span",{children:e.symbol})]},"base_token_".concat(e.symbol)))}),(0,a.jsx)(d.j,{onSelected:e=>{o(e),p.hide()}})]})]})};var en=n(5434),ea=n(9279),es=n(2593),ei=n(10254),er=n(71747),eo=n(18726);function el(e){return Math.floor((Date.now()+e)/1e3)}let ed=e=>{var t;let{tokenAddress:n,autoStart:s,onSigned:r,onFailure:o}=e,{address:l}=(0,M.mA)(),d=new ei.AllowanceProvider(new er.D(1,D.vN),D.xz),c=(0,C.useQuery)(["allowance",n,l||ea.d,D.EY],async()=>await d.getAllowanceData(n,l||ea.d,D.EY),{enabled:!!l}),p={details:{token:n,amount:ei.MaxAllowanceTransferAmount.toBigInt(),expiration:el(2592e6),nonce:(null===(t=c.data)||void 0===t?void 0:t.nonce)||0},spender:D.EY,sigDeadline:el(108e6)},{domain:u,types:m,values:x}=ei.AllowanceTransfer.getPermitData(p,ei.PERMIT2_ADDRESS,1),h=()=>({domain:{name:u.name,chainId:1,version:u.version,salt:u.salt,verifyingContract:u.verifyingContract},types:JSON.parse(JSON.stringify(m)),primaryType:"PermitSingle",message:JSON.parse(JSON.stringify(x))}),{isLoading:y,signTypedDataAsync:g}=(0,M.yw)({...h(),onError:()=>o()}),f=()=>{y||g(h()).then(e=>{let t={...p,signature:e};r(t)})};return(0,i.useEffect)(()=>{s&&f()},[s]),(0,a.jsx)(eo.z,{onClick:()=>f(),loading:y,children:y?"Waiting on Signature":"Sign For Approval"})};var ec=n(91422);let ep=e=>{let t,n;let a=e.in.address,s=e.out.address;return a<s?(t=a,n=s):(t=s,n=a),{token0:t,token1:n,inIsToken0:a===t}},eu=e=>{let{initialToken:t}=e,{address:n}=(0,M.mA)(),{userSelections:s}=(0,$.E)(),r=(0,l.d)(),[o,d]=(0,i.useState)({in:A.U,out:t,amount:0n,poolFee:1e3,quoteType:"EXACT_IN",recipient:n||ea.d,useUniversalRouter:!D.WA,maxSlippage:s.slippage,orderDuration:300});(0,i.useEffect)(()=>d(e=>({...e,recipient:n||ea.d})),[n]);let c="EXACT_IN"===o.quoteType,p=ep(o),u=(0,C.useQuery)(["balances",p.token0,p.token1],async()=>await (0,S.J4)(n,[p.token0,p.token1]),{enabled:!!n,cacheTime:1e4,refetchInterval:1e4,staleTime:1e4}),m=(0,C.useQuery)(["swapQuote",o],async()=>await (0,S.i0)(o),{enabled:o.amount>0n,cacheTime:5e3,staleTime:5e3,refetchInterval:5e3}),h=e=>{var t,n;return e?c?o.amount:null===(t=m.data)||void 0===t?void 0:t.quoteAmount:c?null===(n=m.data)||void 0===n?void 0:n.quoteAmount:o.amount},y=(()=>{let e=m.data;if(!e||0n===e.quoteAmount)return 0;let t="EXACT_IN"===e.swapConfig.quoteType,n=Number((0,N.b)(t?e.swapConfig.amount:e.quoteAmount,e.swapConfig.in.decimals)),a=Number((0,N.b)(t?e.quoteAmount:e.swapConfig.amount,e.swapConfig.out.decimals));return n/a})(),g=[],f=o.in.address===ea.d&&o.out.address===A.tG,b=o.in.address===A.tG&&o.out.address===ea.d;o.in.address===ea.d||f||b||(g.push({name:"Allow Token Transfers",description:"Allow the transfer of your token to the pool",stepRenderer:(e,t)=>(0,a.jsx)(R.rC,{autoStart:!0,spender:A.kx||ea.d,requestMaxValue:!0,amount:"EXACT_IN"===o.quoteType?es.O$.from(o.amount):es.O$.from(m.data.quoteAmount),contractAddress:o.in.address,approvalChanged:t=>{t&&e()},className:"capitalize text-xs w-full"})}),1===D.Kj&&g.push({name:"Sign",description:"Sign the transaction to swap your tokens.",stepRenderer:(e,t)=>(0,a.jsx)(ed,{tokenAddress:o.in.address,autoStart:!0,onFailure:t,onSigned:t=>{d({...o,permit2Permit:t}),e()}})})),g.push({name:"Swap",description:"Swap ".concat(o.in.symbol," for ").concat(o.out.symbol,"."),buttonQuery:()=>(0,C.useQuery)(["swapQuote_order",o],async()=>await (0,S.i0)({...o,recipient:n}).then(e=>({id:"swap",loadingText:"Swapping ".concat(o.in.symbol," for ").concat(o.out.symbol,"..."),...e.functionCallData,enabled:e.swapConfig.recipient!==ea.d&&e.swapConfig.recipient.toLowerCase()===(null==n?void 0:n.toLowerCase()),autoStart:!0})),{enabled:o.amount>0n&&void 0!==n,cacheTime:0})});let w=e=>!u.isLoading&&u.data?p.token0===e?u.data[0]:u.data[1]:0n,v=()=>{if(0n===o.amount||u.isLoading)return!0;let e="EXACT_IN"===o.quoteType;if(!e&&m.isLoading)return!0;let t=BigInt(e?o.amount:m.data.quoteAmount),n=BigInt(w(o.in.address));return t<=n};return(0,a.jsxs)("div",{className:"flex-grow flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"w-full flex flex-col items-end justify-end",children:[(0,a.jsx)(K.h,{}),(0,a.jsxs)("div",{className:"w-full relative flex flex-col gap-1",children:[(0,a.jsx)(et,{balance:w(o.in.address),label:"You pay",value:h(!0),isLoading:m.isLoading&&"EXACT_OUT"===o.quoteType,onChange:e=>{d({...o,amount:e||0n,quoteType:"EXACT_IN"})},token:o.in,onTokenSelect:e=>{d(t=>({...t,in:e,out:e.address===t.out.address?t.in:t.out}))}}),(0,a.jsx)(et,{balance:w(o.out.address),label:"You receive",value:h(!1),isLoading:m.isLoading&&"EXACT_IN"===o.quoteType,onChange:e=>{d({...o,amount:e||0n,quoteType:"EXACT_OUT"})},token:o.out,onTokenSelect:e=>{d(t=>({...t,out:e,in:e.address===t.in.address?t.out:t.in}))}}),(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:(0,a.jsx)("div",{className:"rounded-md border border-neutral-content/20 bg-base-200 hover:bg-base-300 cursor-pointer p-1",onClick:()=>{d({...o,in:o.out,out:o.in,quoteType:"EXACT_IN"===o.quoteType?"EXACT_OUT":"EXACT_IN"})},children:(0,a.jsx)(en.Llt,{size:24})})})]})]}),(()=>{let e=o.in,t=o.out;return e.hasUniV2Pools||t.hasUniV2Pools||!1})()?(0,a.jsx)(U.y,{message:"Most optimal route contains V2 pools and currently isn't supported by our smart router."}):(0,a.jsx)(_.h,{id:"swap_".concat(o.in.address,"_").concat(o.out.address,"_").concat(o.recipient,"_").concat(o.quoteType),transactionChain:g,enabled:void 0!==n&&o.amount>0&&m.isSuccess&&v()&&m.data.swapConfig.recipient!==ea.d&&m.data.swapConfig.recipient.toLowerCase()===n.toLowerCase(),onSuccess:()=>u.refetch(),title:v()?f?"Wrap ETH":b?"Unwrap ETH":"Swap":"Insufficient Balance"},"swap_".concat(o.in.address,"_").concat(o.out.address,"_").concat(o.recipient,"_").concat(o.quoteType)),("0xc8d8d820f88df3bd48c4f8e95bca3b994b73c699"===o.in.address.toLowerCase()||"0xc8d8d820f88df3bd48c4f8e95bca3b994b73c699"===o.out.address.toLowerCase())&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo.z,{buttonType:eo.L.YELLOW,onClick:r.show,children:"Fractionalize Blastopians"}),(0,a.jsx)(l.u,{...r,children:(0,a.jsx)(ec.Q,{})})]}),!f&&!b&&m.isSuccess&&(0,a.jsxs)("div",{className:"standard-stack !gap-2",children:[(0,a.jsxs)("div",{className:"text-sm",children:["1 ",o.out.symbol," = ",y.toLocaleString([],{maximumFractionDigits:y<1?7:3})," ",o.in.symbol]}),(0,a.jsx)(H.Z,{label:"Price Impact",className:"text-sm",isLoading:m.isLoading,isError:m.isError,data:m.data,disabled:0n===o.amount,tooltip:"The difference your trade will make on the market price of the asset due to its size.",children:e=>(0,a.jsxs)("span",{className:x()({"text-white":.02>Math.abs(e.priceImpact),"text-put":Math.abs(e.priceImpact)>=.02}),children:[1e-4>Math.abs(e.priceImpact)?"~":""," ",(100*e.priceImpact).toFixed(2)," %"]})}),(0,a.jsx)(H.Z,{label:"Fees",className:"text-sm",isLoading:m.isLoading,isError:m.isError,data:m.data,disabled:0n===o.amount,children:e=>(0,a.jsx)("span",{className:"flex flex-row items-center text-call",children:"No Fee"})}),(0,a.jsx)(H.Z,{label:"Order Routing",className:"text-sm",tooltip:"The order route that will be executed to open your position.",isLoading:m.isLoading,isError:m.isError,data:m.data,disabled:0n===o.amount,children:e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{id:"order_routing",className:"text-white cursor-help",children:"WasabiSmartRouter"}),(0,a.jsx)("div",{className:"text-sm text-neutral-content",children:(0,a.jsx)(G.u,{anchorSelect:"#order_routing",id:"order_routing_tooltip",place:"top",className:"z-50 text-lg font-bold",style:{backgroundColor:"#3b485f",color:"#98a2b3"},children:(0,a.jsx)(X,{swapQuote:e})})})]})})]})]})};var em=n(31192);let ex=e=>"long"===e?"short":"long",eh=e=>{let t,{perpConfig:n}=e,{userSelections:s,handleSelection:r}=(0,$.E)(),[o,l]=(0,i.useState)(n.parameters.maxLeverage),[d,c]=(0,i.useState)(),[p,u]=(0,i.useState)(n.token.tokenType===k.i.FLC_FRACTION),[m,g]=(0,L.W)("side",s.side||"long",e=>"short"===e||"swap"===e?e:"long"),_=D.WA?3:6;(0,i.useEffect)(()=>{n.token.tokenType!==k.i.FLC_FRACTION&&p&&u(!1),n.parameters.maxLeverage<o&&l(n.parameters.maxLeverage)},[n.token]);let{address:I}=(0,M.mA)(),{balance:A}=(0,i.useContext)(W.o),{showInUsd:R}=(0,em.Bh)(),z=B(o,100),F=B(d,300),Z=n.token.address===D.SD,{data:J,isError:ee,isLoading:et,isSuccess:en}=(0,C.useQuery)(["quote",n.token.address,m,z,F],async()=>await (0,S.RW)(n.token.address,Z?ex(m):m,F||0n,z,s.slippage),{enabled:"swap"!==m&&void 0!==F&&F>0,cacheTime:2e4,staleTime:2e4,refetchInterval:2e4});return(0,a.jsxs)("div",{className:"flex flex-col gap-3 justify-start overflow-y-auto no-scrollbar",children:[(0,a.jsx)(f,{side:m,onChange:e=>{g(e),r("side",e)}}),"swap"===m?(0,a.jsx)(eu,{initialToken:n.token}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{id:"perp-section-input",className:"standard-stack",children:[(0,a.jsxs)("div",{className:"w-full flex flex-row items-center justify-between",children:[(0,a.jsx)("div",{className:"text-md font-light",children:"Pay"}),(0,a.jsx)(K.h,{})]}),(0,a.jsx)(w.r,{value:d,onChange:e=>c(e),symbol:"ETH",placeholder:"0.0",tokenDecimals:18})]}),(0,a.jsxs)("div",{id:"perp-section-output",className:"standard-stack",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 text-md font-light",children:[(0,y.f)(m),(null==J?void 0:J.outputSizeInETH)&&(0,a.jsx)("div",{className:"flex flex-row items-center text-sm",children:Z?(0,a.jsxs)("span",{children:["$",Number((0,N.b)(J.outputSize,18)).toLocaleString([],{maximumFractionDigits:2})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.$$w,{})," ",parseFloat(Number((0,N.b)(J.outputSizeInETH,18)).toFixed(3)).toString()]})})]}),(0,a.jsx)(v.U,{displayTokenSelect:!0,value:J?Z?J.outputSizeInETH:J.outputSize:0n,isLoading:et,placeholder:"0.0",imageUrl:n.token.imageUrl,symbol:(t=n.token.symbol,p&&(t=t.replace("Î¼","")),"USDB"===t&&(t="ETH"),t),tokenDecimals:((null==J?void 0:J.token.decimals)||18)+(p?1:0)*_})]}),(0,a.jsxs)("div",{id:"perp-section-leverage",className:"standard-stack",children:[(0,a.jsx)("div",{className:"text-md font-light",children:"Set Leverage"}),(0,a.jsxs)("div",{className:"flex flex-row gap-3 items-center justify-between",children:[(0,a.jsx)(b.Z,{className:"flex items-center justify-center w-full flex-grow",thumbClassName:"customSlider-thumb",trackClassName:"customSlider-track",defaultValue:1.1,min:1.1,step:.1,max:n.parameters.maxLeverage,renderThumb:"0x58cb30368ceb2d194740b144eab4c2da8a917dcb"===n.token.address?(e,t)=>(0,a.jsx)("div",{...e,children:(0,a.jsx)("img",{src:"https://wasabi-public.s3.amazonaws.com/zyn_slider.webp",alt:"zyn",className:"w-[24px] h-[24px] rounded-full"})}):void 0,value:o,onChange:l}),(0,a.jsxs)("span",{className:"text-2xl min-w-[60px] text-right",children:[o,"0x58cb30368ceb2d194740b144eab4c2da8a917dcb"===n.token.address?(0,a.jsx)("span",{className:"text-sm",children:"mg"}):"x"]})]})]}),(0,a.jsxs)("div",{id:"perp-section-summary",className:"standard-stack",children:[n.token.nftAddress&&(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 text-sm",children:[(0,a.jsx)("span",{children:"View as Full NFT"}),(0,a.jsx)(E.Z,{checked:p,onColor:P.theme.extend.colors.call,checkedIcon:!1,height:16,width:32,handleDiameter:16,uncheckedIcon:!1,onChange:e=>u(e.valueOf())})]}),(n.token.address===D.SD||D.WA&&"short"===m)&&(0,a.jsx)(H.Z,{label:(0,a.jsxs)("div",{className:"flex flex-row items-end",children:[(0,a.jsx)("img",{src:"/static/blast.svg",className:"h-6 w-6",alt:"blast_earning"}),(0,a.jsx)("span",{className:"italic",children:"oost"})]}),className:"text-sm text-[#FCFC05]",isLoading:!1,isError:!1,data:n,disabled:!d,tooltip:"Trading this pair rewards Blast points. Higher leverage will earn more points.",children:e=>(0,a.jsx)("div",{className:"flex flex-row gap-1 items-center",children:(0,a.jsxs)("span",{className:"text-[#FCFC05] text-xl",children:[o,"x"]})})}),(0,a.jsx)(H.Z,{label:"Entry Price",className:"text-sm",isLoading:et,isError:ee,data:J,disabled:!d,tooltip:"The price at which your position will be opened.",children:e=>(0,a.jsx)(j.i,{price:e.entryPrice,showInUsd:R,showAsFullNFT:p,tokenType:n.token.tokenType,tokenAddress:n.token.address})}),(0,a.jsx)(H.Z,{label:"Price Impact",className:"text-sm",isLoading:et,isError:ee,data:J,disabled:!d,tooltip:"The difference your trade will make on the market price of the asset due to its size.",children:e=>(0,a.jsxs)("span",{className:x()({"text-white":.02>Math.abs(e.swapQuote.priceImpact),"text-put":Math.abs(e.swapQuote.priceImpact)>=.02}),children:[1e-4>Math.abs(e.swapQuote.priceImpact)?"~":""," ",(100*e.swapQuote.priceImpact).toFixed(2)," %"]})}),(0,a.jsx)(H.Z,{label:"Liquidation Price",className:"text-sm",isLoading:et,isError:ee,data:J,disabled:!d,tooltip:"The price at which your position will be automatically closed to prevent further losses.",children:e=>(0,a.jsx)(j.i,{price:e.liquidationPrice,showInUsd:R,showAsFullNFT:p,tokenType:n.token.tokenType,tokenAddress:n.token.address})}),(0,a.jsx)(H.Z,{label:"Fees",className:"text-sm",isLoading:et,isError:ee,data:J,disabled:!d,tooltip:"The cost incurred for opening and maintaining your position on the platform.",children:e=>(0,a.jsxs)("span",{className:"flex flex-row items-center text-white",children:[(0,a.jsx)(h.$$w,{})," ",(0,T.d)(e.fee)]})}),(0,a.jsx)(H.Z,{label:"Borrow Rate",className:"text-sm",isLoading:et,isError:ee,data:J,disabled:!d,tooltip:"The current hourly interest rate for opening a levered position.",children:e=>{let t=BigInt(e.principal)*BigInt(Math.round(1e6*e.hourlyBorrowFee))/BigInt(1e6),n=(0,N.b)(t,e.token.decimals);return(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-white",id:"borrow_rate",children:[(100*e.hourlyBorrowFee).toFixed(4),"% / 1h"]}),(0,a.jsx)("div",{className:"text-sm text-neutral-content",children:(0,a.jsxs)(G.u,{anchorSelect:"#borrow_rate",id:"borrow_rate_tooltip",place:"top",className:"z-50 text-lg font-bold",style:{backgroundColor:"#3b485f",color:"#98a2b3"},children:[Number(n).toLocaleString([],{maximumFractionDigits:5})," ","LONG"===e.side?"ETH":e.token.symbol," / 1h"]})})]})}}),(0,a.jsx)(H.Z,{label:"Order Routing",className:"text-sm",tooltip:"The order route that will be executed to open your position.",isLoading:et,isError:ee,data:J,disabled:!d,children:e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{id:"order_routing",className:"text-white cursor-help",children:"WasabiSmartRouter"}),(0,a.jsx)("div",{className:"text-sm text-neutral-content",children:(0,a.jsx)(G.u,{anchorSelect:"#order_routing",id:"order_routing_tooltip",place:"top",className:"z-50 text-lg font-bold",style:{backgroundColor:"#3b485f",color:"#98a2b3"},children:(0,a.jsx)(X,{swapQuote:e.swapQuote})})})]})})]}),(0,a.jsx)(Y.D,{className:"!text-sm p-4",children:(0,a.jsx)(O,{enabled:!!I&&!(null==J?void 0:J.errorMessage)&&!!d&&en&&d>0n&&d<=((null==A?void 0:A.toBigInt())||0n),maxSlippage:s.slippage,side:Z?ex(m):m,downPayment:d||0n,leverage:o,tokenAddress:n.token.address,onTransactionSuccess:()=>(0,Q.M8)("perp","open_position","Position Opened: ".concat(m,", ").concat(o,"x, ").concat(d," ETH"),{token:n.token,side:m,leverage:o,downPayment:d})})}),(0,a.jsx)(V.E,{address:n.token.address}),I&&A&&d&&A.toBigInt()<d?(0,a.jsx)(U.y,{message:"Insufficient Balance"}):(0,a.jsxs)(a.Fragment,{children:[(null==J?void 0:J.errorMessage)&&(0,a.jsx)(q.G,{message:J.errorMessage}),ee&&(0,a.jsx)(U.y,{message:"Something went wrong"})]})]})]})};var ey=n(92221),eg=n(66653);let ef=e=>{var t,n,s,r,o,l;let{token:d}=e,{showInUsd:c}=(0,em.Bh)(),p=(0,C.useQuery)(["token_stats",d.address],async()=>await (0,S.lv)((0,ey.K)(d.address)),{refetchInterval:3e3,cacheTime:3e3}),u=e=>{let{label:t,children:n,value:s,prevRef:r}=e,[o,l]=(0,i.useState)(void 0);return(0,i.useEffect)(()=>{s>r.current?l("text-green-500"):s<r.current&&l("text-red-500");let e=setTimeout(()=>{l(void 0)},500);return r.current=s,()=>clearTimeout(e)},[s,t]),(0,a.jsxs)("div",{className:"flex flex-col items-end",children:[(0,a.jsx)("span",{className:"text-sm text-neutral-content font-light",children:t}),p.isLoading&&(0,a.jsx)("div",{className:"min-w-[100px] min-h-[20px] rounded-md bg-slate-600 animate-pulse m-2"}),p.isError&&(0,a.jsx)("span",{className:"text-sm text-put",children:"Error"}),p.isSuccess&&(0,a.jsx)("div",{className:x()("text-xl lg:text-3xl",{"animate-shine":void 0!==o,[o||""]:void 0!==o}),children:n(p.data)})]})};return(0,a.jsxs)("div",{className:"flex flex-row gap-2 lg:gap-12 justify-between lg:justify-evenly items-center",children:[(0,a.jsx)(u,{label:"Price",value:null===(t=p.data)||void 0===t?void 0:t.price,prevRef:(0,i.useRef)(null===(n=p.data)||void 0===n?void 0:n.price),children:e=>(0,a.jsx)(j.i,{exponentClassName:"text-xs text-neutral-content",className:"text-base",showInUsd:c,iconSize:12,price:Number(e.price),tokenAddress:d.address,tokenType:d.tokenType,showAsFullNFT:!1})}),(0,a.jsx)(u,{label:"24h Change",value:null===(s=p.data)||void 0===s?void 0:s.oneDayChange,prevRef:(0,i.useRef)(null===(r=p.data)||void 0===r?void 0:r.oneDayChange),children:e=>(0,a.jsxs)("div",{className:x()("flex flex-row items-center text-base",{"text-put":e.oneDayChange<0,"text-call":e.oneDayChange>0,"text-neutral-content":0===e.oneDayChange}),children:[e.oneDayChange>0?(0,a.jsx)(eg.rBm,{size:20}):(0,a.jsx)(eg.WMq,{size:20}),Math.abs(e.oneDayChange).toFixed(2),"%"]})}),(0,a.jsx)(u,{label:"24h Volume",value:null===(o=p.data)||void 0===o?void 0:o.oneDayVolumeUsd,prevRef:(0,i.useRef)(null===(l=p.data)||void 0===l?void 0:l.oneDayVolumeUsd),children:e=>(0,a.jsxs)("span",{className:"flex flex-row items-center !text-base",children:[(0,a.jsx)("span",{className:"",children:"$"}),(0,z.ER)(e.oneDayVolumeUsd)]})})]})};var eb=n(11163),ew=n(97128),ev=n(69241),ej=n(3909),eN=n(84932),eT=n(76790),ek=n(86546),eC=n(63750),eS=n(30381),eE=n.n(eS),eP=n(89583);let eL=e=>{let{positionId:t,onSuccess:n}=e,{userSelections:s}=(0,$.E)(),[r,o]=(0,i.useState)(!1),l=(0,C.useQuery)(["quoteClose",t,s.slippage],async()=>await (0,S.uy)(t,s.slippage),{staleTime:4e3,refetchInterval:4e3,cacheTime:4e3}),d=[{name:"Close Position",description:"Closing your position",buttonQuery:()=>(0,C.useQuery)(["close_position",t,s.slippage],async()=>{var e;let n=await (0,S.OA)(t,s.slippage),a={id:"close_position",loadingText:"Closing position...",addressOrName:(null===(e=l.data)||void 0===e?void 0:e.position.side)==="LONG"?A.ht:A.xf,functionName:"closePosition",contractInterface:I,args:[D.mC,n.request,n.signature],enabled:!0};return a},{cacheTime:0})}],c=(e,t)=>"LONG"===t.position.side?e:BigInt(e)*BigInt(t.swapQuote.quoteAmount)/BigInt(t.swapQuote.swapConfig.amount),p=()=>{let e;if(!l.data)return;let t=l.data;return e=t.token.address===D.SD?"LONG"===t.position.side?"SHORT":"LONG":t.position.side,(0,a.jsx)("span",{className:x()({"text-call":"LONG"===e,"text-put":"SHORT"===e}),children:e})},u=()=>{if(!l.data)return;let e=l.data;return e.token.address===D.SD?"ETH":l.data.token.name},m=()=>!!l.data&&BigInt(l.data.payout)>BigInt(l.data.position.downPaymentRaw);return(0,a.jsxs)("div",{className:"standard-stack !gap-6 min-w-[300px] xl:min-w-[400px]",children:[(0,a.jsxs)("div",{className:"standard-stack",children:[(0,a.jsxs)("div",{className:"flex flex-row gap-1 items-center justify-between",children:[(0,a.jsx)("span",{className:"text-lg tracking-wider"}),(0,a.jsx)(K.h,{})]}),(0,a.jsx)("hr",{className:"border-neutral-content/50 w-full"}),(0,a.jsx)("div",{className:"!cursor-pointer hover:text-white",onClick:()=>o(e=>!e),children:(0,a.jsx)(H.Z,{label:(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center !cursor-pointer hover:text-white",children:[r?(0,a.jsx)(eP.s$2,{}):(0,a.jsx)(eP.RiI,{})," Details"]}),isLoading:l.isLoading,isError:l.isError,data:l.data,children:e=>(0,a.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,a.jsx)("img",{src:e.token.imageUrl,alt:e.token.symbol,className:"w-6 h-6 rounded-full border border-glass-focus"}),(0,a.jsxs)("span",{children:[u()," ",e.position.leverage,"x ",p()]})]})})}),r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("hr",{className:"border-neutral-content/50 w-full"}),(0,a.jsx)(H.Z,{label:"Opened",isLoading:l.isLoading,isError:l.isError,data:l.data,children:e=>(0,a.jsx)("span",{className:"capitalize",children:eE().unix(e.position.openTimestamp).fromNow()})}),(0,a.jsx)(H.Z,{label:"Entry Price",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The price at which your position was originally opened.",children:e=>(0,a.jsx)(j.i,{price:e.position.entryPrice,tokenAddress:e.token.address,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"})}),(0,a.jsx)(H.Z,{label:"Estimated Exit Price",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The estimated price at which your position will be closed at including slippage and Uniswap fees.",children:e=>(0,a.jsx)(j.i,{price:e.sellPrice,tokenAddress:e.token.address,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"})}),(0,a.jsx)(H.Z,{label:"Liquidation Price",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The price at which your position will be automatically closed to prevent further losses.",children:e=>(0,a.jsx)(j.i,{price:e.liquidationPrice,tokenAddress:e.token.address,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"})}),(0,a.jsx)(H.Z,{label:"Total Interest Paid",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The cumulative interest paid on the position",children:e=>(0,a.jsx)(ek.X,{value:c(e.interestOwed,e)})})]}),(0,a.jsx)("hr",{className:"border-neutral-content/50 w-full"}),(0,a.jsx)(H.Z,{label:"Order Routing",tooltip:"The order route that will be executed to open your position.",isLoading:l.isLoading,isError:l.isError,data:l.data,children:e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{id:"order_routing",className:"text-white cursor-help",children:"WasabiSmartRouter"}),(0,a.jsx)("div",{className:"text-sm text-neutral-content",children:(0,a.jsx)(G.u,{anchorSelect:"#order_routing",id:"order_routing_tooltip",place:"top",className:"z-50 text-lg font-bold",style:{backgroundColor:"#3b485f",color:"#98a2b3"},children:(0,a.jsx)(X,{swapQuote:e.swapQuote})})})]})}),(0,a.jsx)("hr",{className:"border-neutral-content/50 w-full"}),(0,a.jsx)(H.Z,{label:"Down Payment",isLoading:l.isLoading,isError:l.isError,data:l.data,children:e=>(0,a.jsx)(ek.X,{value:e.position.downPaymentRaw})}),(0,a.jsx)(H.Z,{label:"Net Value",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The net value of your position after closing, minus any fees or losses.",children:e=>(0,a.jsx)(ek.X,{value:BigInt(e.payout)+BigInt(e.fee)})}),(0,a.jsx)(H.Z,{label:"PnL",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The amount of profit or loss that will be realized from the position.",children:e=>(0,a.jsx)(ek.X,{className:"flex-row-reverse ",value:BigInt(e.payout)+BigInt(e.fee)-BigInt(e.position.downPaymentRaw),valueForPercent:BigInt(e.payout)+BigInt(e.fee),original:BigInt(e.position.downPaymentRaw)})}),(0,a.jsx)("hr",{className:"border-neutral-content/50 w-full"}),(0,a.jsx)(H.Z,{label:"Close Fees",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The protocol fees to close the position",children:e=>(0,a.jsx)(ek.X,{value:-BigInt(e.fee)})}),(0,a.jsx)(H.Z,{label:"Receive",isLoading:l.isLoading,isError:l.isError,data:l.data,tooltip:"The final amount you will receive after closing your position.",children:e=>(0,a.jsx)(ek.X,{value:BigInt(e.payout)})})]}),(0,a.jsx)(_.h,{id:"close_position",enabled:l.isSuccess,title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eC.mly,{})," Close Position"]}),transactionChain:d,type:F.iU.TRADE,onSuccess:()=>{(0,Q.M8)("perp","close_position","Position Closed: ".concat(t),{positionId:t}),n(m(),{id:l.data.position.id,token:l.data.token,side:l.data.position.side,action:"CLOSE"})}})]})};var e_=n(65060),eI=n(73999),eA=n(12536),eR=n(67202),ez=n(97796),eD=n(6525);let eF=e=>{let{onTokenClicked:t,className:n}=e,{address:s}=(0,eA.x)(),r=(0,eD.A)(),o=(0,C.useQuery)(["positions",s],async()=>await (0,S.Av)(s||ea.d),{enabled:!!s,refetchInterval:5e3});(0,i.useEffect)(()=>{o.isLoading||o.isRefetching||o.refetch()},[r]);let[d,c]=(0,i.useState)(),[p,u]=(0,i.useState)(),{showInUsd:m}=(0,em.Bh)(),x=e=>{u({id:e.position.id,action:"OPEN",side:e.position.side,token:e.token}),y.show()},h=(0,l.d)(),y=(0,l.d)();(0,i.useEffect)(()=>{d?h.show():h.hide()},[d]),(0,i.useEffect)(()=>{h.modalVisible||c(void 0)},[h.modalVisible]);let g=[{id:"position",label:"Position",valueRenderer:e=>{let n="perp_share_".concat(e.position.id);return(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,a.jsxs)("div",{id:n,className:"hover:scale-110 text-neutral-content hover:cursor-pointer hover:text-white",onClick:()=>x(e),children:[(0,a.jsx)(en.aOG,{size:22}),(0,a.jsx)(G.u,{anchorSelect:"#".concat(n),id:"tooltip_".concat(n),place:"left",noArrow:!0,className:"z-50",content:"Share Your Position",style:{backgroundColor:"#3b485f",color:"#98a2b3"}})]}),(0,a.jsx)(e_.w,{position:e.position,token:e.token,onTokenClicked:e=>t(e.symbol)})]})},sort:(0,eT.V2)(e=>e.token.symbol),span:3},{id:"pnl",label:"PnL",valueRenderer:e=>(0,a.jsx)(ez.o,{positionStatus:e}),tooltip:"Profit and Loss: The amount of profit or loss realized from the position.",align:"left",span:2},{id:"size",label:"Size",tooltip:"The notional size of your position.",valueRenderer:e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ek.X,{className:"cursor-pointer",id:"size_".concat(e.position.id),value:"LONG"===e.position.side?(0,z.v9)(e.position.collateralAmountRaw,e.markPrice):BigInt(e.position.collateralAmountRaw)}),(0,a.jsx)(G.u,{anchorSelect:"#size_".concat(e.position.id),id:"tooltip_size_".concat(e.position.id),place:"top",className:"z-50",style:{backgroundColor:"#3b485f",color:"#98a2b3"},children:(0,a.jsx)(eR.t,{positionStatus:e})})]}),sort:(0,eT.iN)(e=>"LONG"===e.position.side?(0,z.v9)(e.position.collateralAmountRaw,e.markPrice):BigInt(e.position.collateralAmountRaw)),align:"center",span:2},{id:"entryPrice",label:"Entry Price",valueRenderer:e=>(0,a.jsx)(j.i,{price:e.position.entryPrice,tokenAddress:e.token.address,tokenType:e.token.tokenType,showInUsd:m,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"}),tooltip:"The price at which your position was originally opened.",align:"center",span:2},{id:"indexPrice",label:"Index Price",valueRenderer:e=>(0,a.jsx)(j.i,{price:e.markPrice,tokenAddress:e.token.address,tokenType:e.token.tokenType,showInUsd:m,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"}),align:"center",tooltip:"The market price used for valuation and margin calculations.",span:2},{id:"liquidationPrice",label:"Liq. Price",valueRenderer:e=>(0,a.jsx)(j.i,{price:e.liquidationPrice,tokenAddress:e.token.address,tokenType:e.token.tokenType,showInUsd:m,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"}),align:"center",tooltip:"The price at which your position will be automatically closed to prevent further losses.",span:2},{id:"actions",label:"",valueRenderer:e=>(0,a.jsx)("div",{className:"flex flex-row items-center justify-between w-full",children:(0,a.jsx)(eo.z,{buttonType:eo.L.NEUTRAL,onClick:()=>c(e.position),className:"!border-none !px-2 !py-0 !text-lg !font-normal !capitalize",children:"Close"})})}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eT.iA,{id:"perp_positions",className:n,columns:g,data:o.data,isLoading:o.isLoading,emptyText:"No active positions, open a position to get started."}),(0,a.jsx)(l.u,{...h,title:"Close Position",children:d&&(0,a.jsx)(eL,{positionId:d.id,onSuccess:(e,t)=>{o.refetch(),h.hide(),e&&(u(t),y.show())}})}),p&&(0,a.jsx)(l.u,{...y,title:"Share",children:(0,a.jsx)(eI.$,{perpTradeShare:p})})]})};var eO=n(14379),eB=n(50737);let eU=e=>{var t;let{onTokenClicked:n,className:s}=e,{address:r}=(0,eA.x)(),o=(0,C.useInfiniteQuery)(["position_history",r],async e=>{let{pageParam:t="0"}=e;return await (0,S.$3)(r,t)},{getNextPageParam:e=>e.nextPageToken,enabled:!!r,refetchInterval:15e3}),[d,c]=(0,i.useState)(),p=e=>{c({id:e.position.id,action:e.action,side:e.position.side,token:e.token}),u.show()},u=(0,l.d)(),m=[{id:"action",label:"Action",valueRenderer:e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.action}),(0,a.jsxs)("div",{className:"text-xs text-neutral-content",children:["ID: ",e.position.id]})]}),span:2},{id:"position",label:"Position",valueRenderer:e=>(0,a.jsx)(e_.w,{position:e.position,token:e.token,onTokenClicked:e=>n(e.symbol)}),align:"left",span:2},{id:"price",label:"Entry/Exit Price",valueRenderer:e=>(0,a.jsx)(j.i,{price:e.price,tokenAddress:e.token.address,tokenType:e.token.tokenType,iconSize:12,exponentClassName:"flex flex-row items-center text-xs text-neutral-content"}),tooltip:"The price upon entry or exit of the position",align:"left",span:2},{id:"amount",label:"Paid/Received",valueRenderer:e=>(0,a.jsx)(ek.X,{showPlus:!0,value:BigInt(e.amount)*("OPEN"!==e.action?1n:-1n),className:x()({"flex-col items-end":"OPEN"!==e.action})}),tooltip:"The amount of ETH paid or received for the position",align:"left",span:2},{id:"pnl",label:"PnL",valueRenderer:e=>"OPEN"===e.action?null:(0,a.jsx)(ek.X,{showPlus:!0,valueForPercent:BigInt(e.amount)+BigInt(e.fees),value:BigInt(e.amount)+BigInt(e.fees)-BigInt(e.position.downPaymentRaw),original:BigInt(e.position.downPaymentRaw),className:"w-full flex-col items-end"}),tooltip:"The profit or loss of the position before closing fees",align:"right",span:1},{id:"timestamp",label:"Timestamp",sort:(0,eT.dY)(e=>e.timestamp),valueRenderer:e=>{let t="perp_timestamp_".concat(e.position.id,"_").concat(e.action);return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(eO.A,{hash:e.transactionHash,label:(0,a.jsxs)("span",{id:t,className:"text-neutral-content underline decoration-dashed underline-offset-4",children:[(0,a.jsx)("span",{children:eE().unix(e.timestamp).fromNow()}),(0,a.jsx)(G.u,{anchorSelect:"#".concat(t),id:"tooltip_"+(t||"expiresIn_tooltip"),place:"top",noArrow:!0,className:"z-50",content:new Date(1e3*e.timestamp).toLocaleString([],{timeZoneName:"short"}),style:{backgroundColor:"#3b485f",color:"#98a2b3"}})]})})})},align:"right",span:2},{id:"share",label:"",valueRenderer:e=>{let t="history_perp_share_".concat(e.position.id,"_").concat(e.action);return(0,a.jsxs)("div",{id:t,className:"hover:scale-110 text-neutral-content hover:cursor-pointer hover:text-white",onClick:()=>p(e),children:[(0,a.jsx)(en.aOG,{size:22}),(0,a.jsx)(G.u,{anchorSelect:"#".concat(t),id:"tooltip_".concat(t),place:"top-start",noArrow:!0,className:"z-50",content:"Share Your Position",style:{backgroundColor:"#3b485f",color:"#98a2b3"}})]})},align:"right"}],h=o.hasNextPage&&(0,a.jsx)("div",{className:"h-10 flex items-center justify-center hover:bg-glass cursor-pointer text-neutral-content",children:o.isFetchingNextPage?(0,a.jsx)(eB.T,{}):"Load More"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eT.iA,{id:"perp_position_history",className:s,columns:m,data:null===(t=o.data)||void 0===t?void 0:t.pages.flatMap(e=>e.items),actionPressed:()=>{o.isFetchingNextPage||o.fetchNextPage()},actionContent:h,isLoading:o.isLoading,emptyText:"No history"}),d&&(0,a.jsx)(l.u,{...u,children:(0,a.jsx)(eI.$,{perpTradeShare:d})})]})},eq=e=>{let{width:t,height:n,pairAddress:s,theme:i="dark",chartType:r="1",chartResolution:o="30",drawingToolbars:l=!1,chartInUsd:d=!1}=e;return(0,a.jsx)("iframe",{id:"dextools-widget",title:"DEXTools Trading Chart",width:t,height:n,src:"https://www.dextools.io/widget-chart/en/".concat(D.WA?"blast":"ether","/pe-light/").concat(s,"?theme=").concat(i,"&chartType=").concat(r,"&chartResolution=").concat(o,"&drawingToolbars=").concat(l,"&chartInUsd=").concat(d),allowFullScreen:!0})},eW=e=>{let{width:t,height:n,pairAddress:s,address:r,theme:o="dark",chartType:l="1",chartResolution:d="30",drawingToolbars:c=!1,chartInUsd:p=!1}=e,{showInUsd:u}=(0,em.Bh)(),m=r===D.SD,x=m||u?A.tG:D.SD,h=BigInt(x)>BigInt(r),y=m?h?"1":"0":h?"0":"1",g=()=>"https://www.defined.fi/blast/".concat(s,"?quoteToken=token").concat(y,"&quoteCurrency=").concat(m||!u?"TOKEN":"USD","&embedded=1&hideTxTable=1&hideSidebar=1&embedColorMode=DEFAULT"),[f,b]=(0,i.useState)(g());return(0,i.useEffect)(()=>{b(g())},[u,r]),(0,a.jsx)("iframe",{height:"100%",width:"100%",id:"defined-embed",title:"Defined Embed",src:f,frameBorder:"0",allow:"clipboard-write"},s+"_"+x)},eM=[{label:"Active Positions",value:"active"},{label:"Trade History",value:"history"},{label:"Overview",value:"overview"}],eH=()=>{let e=(0,o.E)("lg"),t=(0,eb.useRouter)(),{userSelections:n,handleSelection:r}=(0,$.E)(),[l,d]=(0,L.y)("token",n.token||D.pe),[c,p]=(0,i.useState)(),[m,h]=(0,L.W)("t",eM[0].value,e=>e),{isLoading:y}=(0,C.useQuery)(["perp_config",l],async()=>{try{return await (0,S.Xn)(l)}catch(e){return await (0,S.Xn)(D.pe)}},{enabled:t.isReady,onSuccess:p});(0,i.useEffect)(()=>{c&&c.token.symbol!==l&&((0,Q.M8)("perp","token_select","Selected Token: ".concat(c.token.symbol),{address:c.token.address,symbol:c.token.symbol,name:c.token.name}),d(c.token.symbol)),(null==c?void 0:c.token.symbol)&&r("token",c.token.symbol)},[c]),(0,i.useEffect)(()=>{(0,Q.I6)(t.pathname,"Perps")},[]);let g=e=>{(0,Q.M8)("perp","side_select","Selected Side: ".concat(e),{side:e}),h(e)},f=()=>(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsx)(eN.m,{options:eM,value:m,onChange:g,className:"rounded-none border-y border-x-0 border-neutral-content/20"}),(0,a.jsxs)("div",{className:"flex-grow w-full overflow-y-hidden overflow-x-scroll no-scrollbar",children:["active"===m&&(0,a.jsx)(eF,{className:x()("h-full border-none rounded-none no-scrollbar !bg-transparent",{"min-w-[1000px]":!e}),onTokenClicked:e=>e!==l&&d(e)}),"history"===m&&(0,a.jsx)(eU,{className:x()("h-full border-none rounded-none no-scrollbar !bg-transparent",{"min-w-[1000px]":!e}),onTokenClicked:e=>e!==l&&d(e)}),"overview"===m&&(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(ew.x,{})})]})]}),b=e=>D.WA?(0,a.jsx)(eW,{width:"100%",height:"100%",address:e.token.address,pairAddress:e.token.pairAddress}):(0,a.jsx)(eq,{width:"100%",height:"100%",pairAddress:e.token.pairAddress});return(0,a.jsxs)("div",{className:"w-full h-full flex flex-col no-scrollbar overflow-hidden ",children:[(0,a.jsx)(s.PB,{openGraph:{url:"https://perps.wasabi.xyz/perps",title:"Wasabi",description:"The Decentralized Leverage Protocol"}}),(0,a.jsx)("div",{className:"h-full flex flex-col divide-y divide-neutral-content/20 overflow-hidden items-stretch",children:(0,a.jsxs)("div",{className:"h-full flex-grow flex flex-col-reverse lg:flex-row lg:divide-x divide-neutral-content/20",children:[(0,a.jsxs)("div",{className:"flex-grow flex flex-col divide-y divide-neutral-content/20",children:[(0,a.jsx)("div",{className:"flex flex-col lg:flex-row gap-4 justify-between w-full px-2 py-1",children:y||!c?(0,a.jsx)("div",{className:"rounded-md p-6 w-full h-full bg-slate-600 animate-pulse"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{perpConfig:c,onChange:p}),(0,a.jsx)(ef,{token:c.token})]})}),y||!c?(0,a.jsx)("div",{className:"rounded-md p-6 !gap-6 w-full h-full bg-slate-600 animate-pulse"}):e?(0,a.jsxs)(ej.eh,{direction:"vertical",autoSaveId:"perp_panels",children:[(0,a.jsx)(ej.s_,{maxSize:100,children:b(c)}),(0,a.jsx)(ej.OT,{className:"w-full flex justify-center items-center bg-glass",children:(0,a.jsx)(en.fE1,{className:"text-neutral-content"})}),(0,a.jsx)(ej.s_,{maxSize:100,children:f()})]}):(0,a.jsxs)("div",{className:"w-full standard-stack",children:[(0,a.jsx)("div",{className:"h-[50vh]",children:b(c)}),(0,a.jsx)("div",{children:f()})]})]}),(0,a.jsx)("div",{className:"flex-1 p-4 sm:w-full md:w-full lg:min-w-[400px] lg:max-w-[400px] h-full overflow-y-scroll",children:c?(0,a.jsx)(eh,{perpConfig:c}):(0,a.jsx)("div",{className:"rounded-md p-6 !gap-6 w-full h-full bg-slate-600 animate-pulse"})})]})})]})};eH.getLayout=function(e){return(0,a.jsx)(ev.z,{skipGeofence:!0,fixedHeight:!0,grow:!0,hidePadding:!0,children:e})};var eQ=eH},17667:function(e,t,n){"use strict";function a(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}n.d(t,{f:function(){return a}})}},function(e){e.O(0,[3662,3609,3777,4980,4090,1778,8617,3909,8440,6736,9037,1422,324,7128,9774,2888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);